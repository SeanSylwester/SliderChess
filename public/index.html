<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>SliderChess</title>
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="SliderChess" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <dialog id="aboutDialog">
        <h2 style="margin: 0;">Rules:</h2>
        <ul style="margin: 0;">
            <li>On your turn, you may move a piece OR a tile.</li>
            <li>Tiles can be rotated in-place or swapped with an adjacent tile</li>
            <li>By default, you can't tile-move your king or your opponent's pieces.</li>
            <li>Extra rules are available to set per-game using the checkboxes on the game screen. </li>
                <ul style="margin: 0;">
                    <li>Both players must agree on all the rules before beginning.</li>
                    <ul style="margin: 0;">
                        <li>Rules that you and your opponent have a different selection for are indicated with a ❌.</li>
                        <li>The rules lock on the first move, but they can be unlocked at any time if both players agree.</li>
                    </ul>
                    <li>There are a few rules that I haven't implemented yet regarding castling, double pawn moves, 
                        and en passant. The current behavior is described in the state of the disabled checkboxes.</li>
                    <li>The indented rules are only used if the parent rule is unchecked. 
                        Otherwise, the checkbox is disabled.</li>
                </ul>
        </ul>

        <h2 style="margin-bottom: 0;">Controls:</h2>
        <ul style="margin: 0;">
            <li><strong>Select a tile:</strong> click the edge of a square, or right-click/long-press anywhere.</li>
            <li><strong>Swap two tiles:</strong> with a tile selected, click on an orthogonally adjacent tile.</li>
            <li><strong>Rotate a tile:</strong> with a tile selected, click within the same tile. The bold highlighted square is rotated to the square that you click on.</li>
            <li><strong>Deselect a tile or piece:</strong> click any invalid target location.</li>
            <li><strong>Valid moves</strong> for a selected piece/tile are highlighted in light red.</li>
            <li><strong>The previous move</strong> is highlighted in green.</li>
        </ul>

        <h2 style="margin-bottom: 0;">Credits:</h2>
        <ul style="margin: 0;">
            <li><strong>Created by:</strong> Sean Sylwester</li>
            <li><strong>Inspired by:</strong> <a href="https://xkcd.com/3139/">XKCD #3139</a> by Randall Munroe</spalin>
            <li><strong>Pieces by:</strong> <a href="https://commons.wikimedia.org/wiki/File:Chess_Pieces_Sprite.svg">Wikipedia user Cburnett</a> </li>
            <li>Last updated: 2026-02-13</li>
        </ul>

        <script type='text/javascript' src='https://storage.ko-fi.com/cdn/widget/Widget_2.js'></script>
        <script type='text/javascript'>kofiwidget2.init('Support me on Ko-fi', '#72a4f2', 'Y8Y11UBZKN');kofiwidget2.draw();</script> 
        <div style="display: flex; justify-content: space-between; margin-top: 10px">
            <button onclick="document.getElementById('feedbackDialog').showModal()" style="font-size: large">Give Feedback</button>
            <button onclick="document.getElementById('aboutDialog').close()" style="font-size: large">Close</button>
        </div>
    </dialog>

    <dialog id="feedbackDialog">
        <form id="feedbackForm">
            <h2 style="margin: 0;">Feedback type:</h2>
            <div>
                <div>
                    <input type="radio" id="feedbackFeedback" name="type" value="feedback" checked="true">
                    <label for="feedbackFeedback">Suggestion/Review</label>
                </div>
                <div>
                    <input type="radio" id="feedbackBug" name="type" value="bug">
                    <label for="feedbackBug">Bug/Problem/Complaint</label>
                </div>
            </div>

            <p>
                <label for="feedbackEmail">Email (optional):</label>
                <input type="email" id="feedbackEmail" name="email">
            </p>

            <h2 style="margin: 0;">Comment:</h2>
            <textarea required id="feedbackMessage" name="message" rows="10" style="width: 100%; max-width: 400px;"></textarea>

            <div>
                <button style="font-size: large">Submit</button>
                <button onclick="document.getElementById('feedbackDialog').close();" id="feedbackCancel" type="button" style="font-size: large">Cancel</button>
            </div>
        </form>
    </dialog>
    <dialog id="feedbackThanks">
        <h2>Thank you for your feedback!</h2>
        <button onclick="document.getElementById('feedbackThanks').close()" style="font-size: large">Close</button>
    </dialog>

    <div id="lobby-screen">
        <button class="aboutButton" onclick="document.getElementById('aboutDialog').showModal()">?</button>
        <h1 style="margin: 0; max-width: calc(100% - 40px)">SliderChess Lobby</h1>
        <p style="margin-top: 0">(<span id="nClients">1</span> Players Connected)</p>
        <span>Name:<input type="text" id="playerName"/> <button id="updateName">Update</button></span>

        <h2 style="margin-bottom: 0">Global chat</h2>
        <div id="globalChatDiv">
            <textarea class="chatLog" id="globalChatLog" rows="10" readonly></textarea>
            <div id="globalChatEntryContainer" class="chatEntryContainer">
                <input class="chatEntry" type="text" id="globalChatEntry"/> 
                <button id="sendGlobalChat">Send</button>
            </div>
        </div>

        <h2 style="margin-bottom: 0">Game List (<span id="nGames">1</span> Active Games)</h2>
        <div>
            <button id="refreshGameList">Refresh</button>
            <button id="createGame">Create game</button>
        </div>
        <div id="gameListDiv">
            <ol id="gameList"></ol>
        </div>
    </div>

    <dialog id="createGameDialog">
        <input type="checkbox" id="useTimeControl" checked="true"/><label for="useTimeControl">Use time control?</label> <br>
        <p>
            Bullet<br>
            <button id="time1p0" class="timeControlButton">1+0</button>
            <button id="time1p1" class="timeControlButton">1+1</button>
            <button id="time2p1" class="timeControlButton">2+1</button>
        </p>
        <p>
            Blitz<br>
            <button id="time3p0" class="timeControlButton">3+0</button>
            <button id="time3p2" class="timeControlButton">3+2</button>
            <button id="time5p0" class="timeControlButton">5+0</button>
        </p>
        <p>
            Rapid<br>
            <button id="time10p0"  class="timeControlButton">10+0</button>
            <button id="time15p10" class="timeControlButton">15+10</button>
            <button id="time30p0"  class="timeControlButton">30+0</button>
        </p>
        <p>
            <label for="createTimeInput">Time:</label>
            <input type="number" id="createTimeInput" value="60" class="timeEntry" min="0">
            <label for="createTimeInput"> (min)</label>
            <label for="createIncrementInput">+</label>
            <input type="number" id="createIncrementInput" value="0" class="timeEntry" min="0">
            <label for="createIncrementInput"> (sec)</label>
        </p>
        <p>
            <label for="createPasswordInput">Password:</label>
            <input type="text" id="createPasswordInput"> <br>
            (Note: passwords are stored in plain-text.<br>Don't use your bank password ;p)
        </p>
        <div>
            <button id="createCancelButton" type="button">Cancel</button>
            <button id="createConfirmButton" type="submit">Confirm</button>
        </div>
    </dialog>

    <dialog id="popup">
        <p id="popupP">Placeholder text.</p>
        <div id="popupButtonsDiv"></div>
    </dialog>

    <div id="game-screen">
        <button class="aboutButton" onclick="document.getElementById('aboutDialog').showModal()">?</button>
        <h1 style="margin: 0">Game Room #<span id="gameIdDisplay"></span></h1>
        <div>
            <span>Game password:<input type="text" id="gamePassword"/> <button id="updateGamePassword">Update</button></span> <br>
            <button id="claimWhite">White</button><span id="whitePlayerInfo"></span> <br>
            <button id="claimBlack">Black</button><span id="blackPlayerInfo"></span> <br>
            <button id="claimSpectator">Spectators</button><span id="spectatorInfo"></span> <br>
        </div>

        <div id="boardAndChatContainer">
            <div>
                (<span id="initialTimeTop"></span>+<span id="incrementTop"></span>) <span id="timeLeftTop"></span>
                <span id="capturesTop"></span>
            </div>
            <div id="boardContainer">
                <div><canvas id="board"></canvas></div>

                <div id="movesLogContainer">
                    <div id="movesLogDiv" readonly>
                        <div class="movesLogColumn" contenteditable="true" id="movesLogColumnNum" readonly></div>
                        <div class="movesLogColumn" contenteditable="true" id="movesLogColumnWhite" readonly></div>
                        <div class="movesLogColumn" contenteditable="true" id="movesLogColumnBlack" readonly></div>
                    </div>
                    <div id="movesLogButtonsDiv">
                        <button id="backwardAll">⏮</button>
                        <button id="backward">←</button>
                        <button id="forward">→</button>
                        <button id="forwardAll">⏭</button>
                    </div>
                </div>
            </div>
            <div>
                (<span id="initialTimeBottom"></span>+<span id="incrementBottom"></span>) <span id="timeLeftBottom"></span>
                <span id="capturesBottom"></span>
            </div>

            <div id="gameButtonsDiv">
                <button id="quitGame">Quit</button>
                <button id="flipBoard">Flip board view</button>
                <button id="rewind">Undo</button>
                <button id="unlockRules">Unlock Rules</button>
                <button id="pause">Pause</button>
                <button id="draw">Offer Draw</button>
                <button id="surrender">Surrender</button> <br>
            </div>
            
            <div id="chatContainer">
                <div id="chatDiv">
                    <div>
                        <strong><span id="gameChatName">Game</span> Chat</strong> 
                        <button id="showGlobalChat" style="white-space: nowrap;">Show Global</button>
                    </div>
                    <textarea class="chatLog" id="chatLog" rows="10" readonly></textarea>
                    <div id="chatEntryContainer" class="chatEntryContainer">
                        <input class="chatEntry" type="text" id="chatEntry"/> 
                        <button id="sendChat">Send</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="rulesDiv">
            <div class="rule">
                <input type="checkbox" id="ruleMoveOwnKing" checked="true"/>
                <span id="ruleMoveOwnKingDisagree">❌</span>
                <label for="ruleMoveOwnKing">Forbid tile-moving your own king?</label>
            </div>
                <div class="rule indented-rule">
                    <input type="checkbox" id="ruleMoveOwnKingInCheck" checked="true"/>
                    <span id="ruleMoveOwnKingInCheckDisagree">❌</span>
                    <label for="ruleMoveOwnKingInCheck">Just forbid tile-moving your own king when you're in check?</label>
                </div>
            <div class="rule">
                <input type="checkbox" id="ruleMoveOpp" checked="true"/>
                <span id="ruleMoveOppDisagree">❌</span>
                <label for="ruleMoveOpp">Forbid tile-moving any of your opponent's pieces?</label>
            </div>
                <div class="rule indented-rule">
                    <input type="checkbox" id="ruleUndoTileMove" checked="true"/>
                    <span id="ruleUndoTileMoveDisagree">❌</span>
                    <label for="ruleUndoTileMove">Forbid undoing a tile move?</label>
                </div>
                <div class="rule indented-rule">
                    <input type="checkbox" id="ruleMoveOppKing" checked="true"/>
                    <span id="ruleMoveOppKingDisagree">❌</span>
                    <label for="ruleMoveOppKing">Forbid tile-moving your opponent's king?</label>
                </div>
                <div class="rule indented-rule">
                    <input type="checkbox" id="ruleMoveOppCheck" checked="true"/>
                    <span id="ruleMoveOppCheckDisagree">❌</span>
                    <label for="ruleMoveOppCheck">Forbid tile-moving an opponent piece that's giving check?</label>
                </div>
            <div class="rule">
                <input type="checkbox" id="ruleDoubleMovePawn" checked="true"/>
                <span id="ruleDoubleMovePawnDisagree">❌</span>
                <label for="ruleDoubleMovePawn">Allow pawns to double move from their original rank after being tile-moved?</label>
            </div>
            <div class="rule">
                <input type="checkbox" id="ruleCastleNormal"/>
                <span id="ruleCastleNormalDisagree">❌</span>
                <label for="ruleCastleNormal">Allow castling after your king or rook tile-moves, but only if they are tile-moved back to their original spots?</label>
            </div>
            <div class="rule">
                <input type="checkbox" id="ruleCastleMoved"/>
                <span id="ruleCastleMovedDisagree">❌</span>
                <label for="ruleCastleMoved">Allow castling after your king or rook tile-moves, even if they're not in their original spots?</label>
            </div>
            <div class="rule">
                <input type="checkbox" id="ruleEnPassantTile"/>
                <span id="ruleEnPassantTileDisagree">❌</span>
                <label for="ruleEnPassantTile">Allow en passant from any similar tile move?</label>
            </div>
                <div class="rule indented-rule">
                    <input type="checkbox" id="ruleEnPassantTileHome"/>
                    <span id="ruleEnPassantTileHomeDisagree">❌</span>
                    <label for="ruleEnPassantTileHome">Allow en passant from a tile move from the captured pawn's original rank?</label>
                </div>
            <div class="rule">
                <input type="checkbox" id="ruleIgnoreAll"/>
                <span id="ruleIgnoreAllDisagree">❌</span>
                <label for="ruleIgnoreAll">Ignore all movement rules?</label>
            </div>
        </div>
    </div>

    <img id="piecesSpriteSheet" src="Chess_Pieces_Sprite.svg" style="display:none;" />
    <script type="module" src="/client/client.js"></script>
</body>

</html>